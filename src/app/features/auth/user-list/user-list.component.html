<div class="p-2 mt-5" style="overflow-y: hidden">
  <div class="container card bg-gradient mt-5">
    <h1 class="mt-4">Users List</h1>

     <!-- Search bar section to find a specific blog post by category -->
     <div class="container mt-5">
      <div class="col-md">
        <div class="custom-input-group">
          <!-- Input field for category search; triggers search on 'Enter' or button click -->
          <input
            type="text"
            id="fearchField"
            class="form-control"
            (keyup.enter)="onSearch(queryText.value)"
            placeholder="Find category"
            aria-label="Find category"
            aria-describedby="basic-addon1"
            #queryText
          />
          <!-- Search button that triggers the same 'onSearch' method -->
          <button
            class="btn btn-secondary inside-btn"
            (click)="onSearch(queryText.value)"
          >
            <i class="bi bi-search"></i>
            <!-- Bootstrap search icon -->
          </button>
        </div>
      </div>
    </div>

    <!-- Check if the users observable has emitted data -->
    @if (users$ | async; as users ) {
    <table
      class="table table-bordered mt-4 rounded-3"
      style="overflow: hidden"
    >
      <thead>
        <tr class="align-middle text-center">
          <th>
            <div class="d-flex justify-content-between">
              <div class="d-flex justify-content-start">
                <span class="mt-2">Username</span>
              </div>
              <div class="d-flex justify-content-end">
                <span>
                  <button
                    type="button"
                    class="btn btn-secondary ms-2"
                    (click)="sort('userName', 'asc')"
                  >
                    <i class="bi bi-arrow-up"></i>
                  </button>
                </span>
                <span>
                  <button
                    type="button"
                    class="btn btn-secondary ms-2"
                    (click)="sort('userName', 'desc')"
                  >
                    <i class="bi bi-arrow-down"></i>
                  </button>
                </span>
              </div>
            </div>
          </th>
          <th>
            <span class="d-flex justify-content-center align-items-center mb-1">
              <i class="bi bi-tools"></i>
            </span>
          </th>
        </tr>
      </thead>
      <tbody>
        <!-- Loop through the users and display each user -->
        @for (user of users; track user) {
        <tr>
          <td>{{ user.userName }}</td>
          <td>
            <span class="d-flex justify-content-center align-items-center">
              <!-- Button to trigger delete confirmation modal -->
              <button
                type="button"
                class="btn btn-danger ms-2"
                data-bs-toggle="modal"
                data-bs-target="#deleteUserModal"
                (click)="setUserId(user.id)"
              >
                Delete
              </button>

              <!-- Delete confirmation modal -->
              <div
                class="modal fade"
                id="deleteUserModal"
                data-bs-backdrop="static"
                data-bs-keyboard="false"
                tabindex="-1"
                aria-labelledby="deleteUserModalLabel"
                aria-hidden="true"
              >
                <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h1 class="modal-title fs-5" id="deleteUserModalLabel">
                        Delete User
                      </h1>
                      <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                      ></button>
                    </div>
                    <div class="modal-body">
                      Do you really want to delete this user?
                    </div>
                    <div class="modal-footer">
                      <button
                        type="button"
                        class="btn btn-secondary"
                        data-bs-dismiss="modal"
                      >
                        Close
                      </button>
                      <button
                        type="button"
                        class="btn btn-danger"
                        (click)="onDelete()"
                        data-bs-dismiss="modal"
                      >
                        Delete
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </span>
          </td>
        </tr>
        }
      </tbody>
    </table>
    }

    <div class="d-flex justify-content-between">
      <div class="flex-column align-item-start">
        <span class="card p-2 bg-gradient mb-2">
          The current user count: {{ totalCount }}
        </span>
      </div>
      @if (this.totalCount > 5) {
      <div class="flex-column align-item-end">
        <nav aria-label="Page navigation">
          <ul class="pagination">
            <li class="page-item">
              <button class="page-link" (click)="getPrevPage()">
                Previous
              </button>
            </li>
            @for (item of list; track $index; let idx = $index) {
            <li class="page-item">
              <button class="page-link" (click)="getPage(idx + 1)">
                {{ idx + 1 }}
              </button>
            </li>
            }
            <li class="page-item">
              <button class="page-link" (click)="getNextPage()">Next</button>
            </li>
          </ul>
        </nav>
      </div>
      }
    </div>
  </div>
</div>
